<!DOCTYPE html>
<html>
<head>
	<title>Mylene exo TD4</title>
	<style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	crossorigin=""/> <!-- leaflet-step1 -->
	<meta charset="utf-8"/>
</head>
<body>
	<h3>TD4</h3>
	<p>exo</p><br/>

	<div id="app"></div>
	
	<!-- MAP -->
	<div id="map"></div>
	<style>#map { height: 100vh; }</style>		
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin=""></script>

	<script src="https://threejs.org/build/three.js"></script>
	<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
	<script src="https://threejs.org//examples/js/loaders/GLTFLoader.js"></script>
	<script>

		// scène
		const scene = new THREE.Scene();
		// caméra
		const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
		camera.position.set(2,0,5);
		//camera.position.z = 10; //pour s'éloigner

		//renderer
		var app = document.getElementById("app");
		const renderer = new THREE.WebGLRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );
		app.appendChild( renderer.domElement );
		const controls = new THREE.OrbitControls( camera, renderer.domElement );
		controls.update();

		// lumières
		const directionalLight = new THREE.DirectionalLight( 0xffffff, 1.5 );
		scene.add( directionalLight );
		const ambiance = new THREE.AmbientLight( 0x404040 );
		scene.add(ambiance);
		const ambiance2 = new THREE.AmbientLight( 0x444444 );
		scene.add(ambiance2);

		// planète Terre
		const geometryE = new THREE.SphereGeometry();
		const textureE = new THREE.TextureLoader().load( './textures/2k_earth_daymap.jpg' );
		const materialTexE = new THREE.MeshBasicMaterial( { map: textureE } );
		const earth = new THREE.Mesh( geometryE, materialTexE );
		earth.position.set(0,0,0);
		scene.add( earth ) ;

		//récupération de la position
		navigator.geolocation.getCurrentPosition(success, error);
		function success(pos) {
				console.log("success");
				var map = L.map('map').setView([pos.coords.latitude, pos.coords.longitude], 12);
				L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="https://stamen-tiles-{S}.a.ssl.fastly.net">OpenStreetMap</a> contributors'
				}).addTo(map);
				var msg = 'vous êtes ici';// Affichage position
				L.marker([pos.coords.latitude, pos.coords.longitude]).addTo(map)
					.bindPopup(msg)
					.openPopup();
			}
			function error(err) {console.warn(`ERREUR (${err.code}): ${err.message}`);}

		//Affichage de la position sur la Terre
		

		const animate = function () {
			requestAnimationFrame( animate );
			renderer.render( scene, camera );
		};
		animate();
		

	</script>
</body>
</html>