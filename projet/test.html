<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenLayers</title>
    <!-- <style>
      @import "node_modules/ol/ol.css";
    </style> -->
    <style>
      html, body, #map-container {
        margin: 0;
        height: 100%;
        width: 100%;
        font-family: sans-serif;
      }
      .locate {
        top: 6em;
        left: .5em;
        }

    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <div id="map-container"></div>
    
    <!-- <script src="test.js" type="module"></script> -->

    <script lang="javascript">
//         import OSM from 'ol/source/OSM';
// import TileLayer from 'ol/layer/Tile';
// import {Map, View} from 'ol';
// import {fromLonLat} from 'ol/proj';
// import VectorLayer from 'ol/layer/Vector';
// import VectorSource from 'ol/source/Vector';
// import Feature from 'ol/Feature';
// import Point from 'ol/geom/Point';
// import {circular} from 'ol/geom/Polygon';
// import Control from 'ol/control/Control';
// import {Fill, Icon, Style} from 'ol/style';
// import Kompas from 'kompas';



const map = new ol.Map({
  target: 'map-container',
  layers: [
    new ol.layer.Tile({
      source: new ol.source.OSM(),
    }),
  ],
  view: new ol.View({
    center: ol.proj.fromLonLat([0, 0]),
    zoom: 2,
  }),
});

//const source = new VectorSource();
const source = new ol.source.Vector();
const layer = new ol.layer.Vector({
  source: source,
});
map.addLayer(layer);

navigator.geolocation.watchPosition(
    function (pos) {
      const coords = [pos.coords.longitude, pos.coords.latitude];
      const accuracy = ol.geom.Polygon.circular(coords, pos.coords.accuracy);
      source.clear(true);
      source.addFeatures([
        new ol.Feature(
          accuracy.transform('EPSG:4326', map.getView().getProjection())
        ),
        new ol.Feature(new ol.geom.Point(ol.proj.fromLonLat(coords))),
      ]);
    },
    function (error) {
      alert(`ERROR: ${error.message}`);
    },
    {
      enableHighAccuracy: true,
    }
  );
  

  const locate = document.createElement('div');
  locate.className = 'ol-control ol-unselectable locate';
  locate.innerHTML = '<button title="Locate me">â—Ž</button>';
  locate.addEventListener('click', function () {
    if (!source.isEmpty()) {
      map.getView().fit(source.getExtent(), {
        maxZoom: 18,
        duration: 500,
      });
    }
  });
  map.addControl(
    new ol.control.Control({
      element: locate,
    })
  );

  const style = new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(0, 0, 255, 0.2)',
    }),
    image: new ol.style.Icon({
      src: 'https://freeiconshop.com/wp-content/uploads/edd/location-arrow-solid.png',
      imgSize: [27, 55],
      rotateWithView: true,
    }),
  });
  layer.setStyle(style);
  

  if (
    window.DeviceOrientationEvent &&
    typeof DeviceOrientationEvent.requestPermission === 'function'
  ) {
    locate.addEventListener('click', function () {
      DeviceOrientationEvent.requestPermission()
        .then(function () {
          const compass = new Kompas();
          compass.watch();
          compass.on('heading', function (heading) {
            style.getImage().setRotation((Math.PI / 180) * heading);
          });
        })
        .catch(function (error) {
          alert(`ERROR: ${error.message}`);
        });
    });
  }
  


    </script>
  </body>
</html>
